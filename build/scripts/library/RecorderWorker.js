function init(e){sampleRate=e.sampleRate}function record(e){recBuffersL.push(e[0]),recBuffersR.push(e[1]),recLength+=e[0].length}function exportWAV(e,t){if(typeof t!="undefined")var n=t[0],r=t[1];else var n=mergeBuffers(recBuffersL,recLength),r=mergeBuffers(recBuffersR,recLength);var i=interleave(n,r),s=encodeWAV(i),o=new Blob([s],{type:e});this.postMessage(o)}function getBuffer(){var e=[];e.push(mergeBuffers(recBuffersL,recLength)),e.push(mergeBuffers(recBuffersR,recLength)),this.postMessage(e)}function clear(){recLength=0,recBuffersL=[],recBuffersR=[]}function mergeBuffers(e,t){var n=new Float32Array(t),r=0;for(var i=0;i<e.length;i++)n.set(e[i],r),r+=e[i].length;return n}function interleave(e,t){var n=e.length+t.length,r=new Float32Array(n),i=0,s=0;while(i<n)r[i++]=e[s],r[i++]=t[s],s++;return r}function floatTo16BitPCM(e,t,n){for(var r=0;r<n.length;r++,t+=2){var i=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,i<0?i*32768:i*32767,!0)}}function writeString(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}function encodeWAV(e){var t=new ArrayBuffer(44+e.length*2),n=new DataView(t);return writeString(n,0,"RIFF"),n.setUint32(4,32+e.length*2,!0),writeString(n,8,"WAVE"),writeString(n,12,"fmt "),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,2,!0),n.setUint32(24,sampleRate,!0),n.setUint32(28,sampleRate*4,!0),n.setUint16(32,4,!0),n.setUint16(34,16,!0),writeString(n,36,"data"),n.setUint32(40,e.length*2,!0),floatTo16BitPCM(n,44,e),n}var recLength=0,recBuffersL=[],recBuffersR=[],sampleRate;this.onmessage=function(e){switch(e.data.command){case"init":init(e.data.config);break;case"record":record(e.data.buffer);break;case"exportWAV":exportWAV(e.data.type,e.data.buffers);break;case"getBuffer":getBuffer();break;case"clear":clear()}};