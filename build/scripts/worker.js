self.onmessage=function(e){var t;switch(e.data.action){case"waveform-peaks":t=calculateWaveformPeaks(e.data.data,e.data.width);break;case"get-selection-buffer":t=getSelectionBuffer(e.data.data,e.data.start,e.data.end,e.data.fps);break;case"normalize-buffer":t=normalizeBuffer(e.data.data,e.data.start,e.data.end);break;case"cut-buffer":t=cutBuffer(e.data.data,e.data.start,e.data.end);break;case"insert-buffer":t=insertBuffer(e.data.data,e.data.insertBuffer,e.data.start);break;case"adjust-buffer-gain":t=adjustBufferGain(e.data.data,e.data.amount,e.data.start,e.data.end);break;case"default":t={}}var n={data:t,action:e.data.action};self.postMessage(n)};var getMax=function(e,t,n){var r=0,i,s=t;for(var o=0,u=n-t;o<u;o++){var i=e[s++];i<0&&(i=-i),r=i>r?i:r}return r},normalizeBuffer=function(e,t,n){var r=0,i=0;n=Math.round(n),t=Math.round(t);for(var s=0,o=e.length;s<o;s++)i=getMax(e[s],t,n),i=r<i?i:r,r=i;var u=1/i;for(s=0,o=e.length;s<o;s++){var a=t,f=e[s];for(var l=0,c=n-t;l<c;l++){var h=f[a]*u;f[a]=h>1?1:h<-1?-1:h,a++}}return e},adjustBufferGain=function(e,t,n,r){r=Math.round(r),n=Math.round(n);for(i=0,_len=e.length;i<_len;i++){var s=n,o=e[i];for(var u=0,a=r-n;u<a;u++)o[s]=o[s]*t,s++}return e},cutBuffer=function(e,t,n){var r,i=e[0].length,s,o=[],u=[];t=Math.round(t),n=Math.round(n),s=n-t,r=i-s;for(var a=0,f=e.length;a<f;a++){var l=e[a],c=[],h=0,p=[],d=0,v=0;for(var m=0;m<r;m++)h>=t&&h<n?(p[d]=l[h],d++):(c[v]=l[h],v++),h++;u.push(p),o.push(c)}return{buffers:o,cutBuffers:u}},insertBuffer=function(e,t,n){var r,i=e[0].length,s=[],o;n=Math.round(n),r=i+t[0].length,o=n+t[0].length;for(var u=0,a=e.length;u<a;u++){var f=e[u],l=[],c=0,h=0;for(var p=0;p<r;p++)p>=n&&p<o?(l[p]=t[u][c],c++):(l[p]=f[h],h++);s.push(l)}return s},getSelectionBuffer=function(e,t,n,r){var i,s,o=[],u=Math.round(t*r),a=Math.round(n*r);for(var f=0,l=e.length;f<l;f++){i=[],s=0;for(var c=u;c<=a;c++)i[s++]=e[f][c];o.push(i)}return o},calculateWaveformPeaks=function(e,t){var n=e[0].length/t,r=Array.prototype.slice,i=[];for(var s=0,o=t;s<o;s++){var u=0;for(var a=0,f=e.length;a<f;a++){var l=r.call(e[a],s*n,(s+1)*n),c=Math.max.apply(Math,l.map(Math.abs));typeof c=="undefined"&&(c=0),u+=c}i[s]=u}return i};