define(["controllers/BaseController","components/ScriptNode"],function(e,t){var n=function(e){return typeof e!="undefined"},r=function(e,t,n){return Math.max(Math.min(n,t),e)},i=function(){switch(this._type){case 0:return function(e){var t=e.target.context.currentTime;this._value=Math.sin(t*this._speed)*(this._amplitude/2)+.5,this.trigger(this._value*this._max+this._offset)};case 1:return function(e){var t=e.target.context.currentTime,n=Math.sin(t*this._speed),r=this._amplitude;this._value=n>0?1*r:n<0?-1*r:n===0?0:0,this._value=this._value/2+.5,this.trigger(this._value*this._max+this._offset)};case 2:return function(e){var t=e.target.context.currentTime,n=(Math.sin(t*this._speed)+.66666)*.75,r=this._amplitude,i=1/this._steps,s=0;for(var o=1;o<=this._steps+1;o++)n>=s&&n<=s+i&&(this._value=s*r),s+=i;this.trigger(this._value*this._max+this._offset)};case 3:return function(e){var t=e.target.context.currentTime;this._value=this._speed/10*t%1,this.trigger(this._value*this._max+this._offset)};case 4:return function(e){var t=e.target.context.currentTime;this._value=this._speed/10*t%2<1?this._speed/10*t%1-.5:.5-this._speed/10*t%1,this.trigger(this._value*this._max+this._offset)};default:return function(){}}},s=e.extend({init:function(e,i,s,o,u){this._super.apply(this,arguments);var a=this,f=new t(this.context,settings.get("bufferSize"),1,1);f.onAudioProcess(function(e){a.calculate(e)}),this.node=f,this._amplitude=n(s)?r(0,1,s):1,this._speed=n(i)?i:1,this._value=0,this._max=n(o)?o:1,this._offset=n(u)?u:0,this._steps=4,this.setType(0),this.enable()},connectParameter:function(e){this.params.push(e)},calculate:function(e){},setSpeed:function(e){this._speed=e},setAmplitude:function(e){this._amplitude=r(0,1,e)},setMax:function(e){this._max=e},setOffset:function(e){this._offset=e},setType:function(e){this._type=parseInt(e),this.calculate=i.call(this)},getPreProcessValue:function(){return this._value},disable:function(){this.node.getInputNode().disconnect()},enable:function(){this.node.getInputNode().connect(this.node.getContext().destination)}});return s.prototype.Types={SINE:0,SQUARE:1,STEP:2,SAWTOOTH:3},s});