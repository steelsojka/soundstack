define(["views/StackModuleView"],function(e){var t=Backbone.View.extend({id:"effects-stack",className:"tab-content",initialize:function(){_.bindAll(this),this._sortStartIndex=0,this._sortEndIndex=0,this.template=env==="web"?_.template($("#templates #effects-stack-template").html()):templates.effects_stack_template,this.$container=$(".right-pane"),this.$container.prepend(this.$el),this.loader=this.options.loader,this.collection.on("add",this.renderModule),this.collection.on("remove load-remove",this.removeModule),this.bindSortable(),this.render()},renderModule:function(t,n,r){new e({model:t,$container:this.$el,insertIndex:r,collection:this.collection}),this.$el.sortable("refresh")},removeModule:function(e){var t=e.cid;this.$el.children("div[data-cid="+t+"]").remove()},render:function(){var e=this;this.$el.html(""),this.$el.addClass("selected"),this.collection.each(function(t){e.renderModule(t)})},destroySortable:function(){this.$el.sortable("destroy"),this.$el.off("update")},bindSortable:function(){this.$el.sortable({items:".stack-module:not(.drag-disable)",handle:".handle",distance:15,opacity:.7,axis:"y",update:this.onStackSorted,start:this.onStackSortStart}),this.$el.disableSelection()},onStackSorted:function(e,t){this._sortEndIndex=t.item.index(),this.collection.updateItemPosition(this._sortStartIndex,this._sortEndIndex)},onStackSortStart:function(e,t){this._sortStartIndex=t.item.index()},resetStack:function(){},load:function(e){var t=this.loader.getModulesToLoad(e);this.collection.each(this.removeModule),this.collection.reset(),this._loadIndex=0,this._load(t)},_load:function(e){var t=this,n=this.collection,r=e[this._loadIndex],i=e;r.model.loadModule(function(){n.createModule(r.model,r.settings,r.globals,function(){_.isUndefined(i[t._loadIndex+1])||(t._loadIndex++,t._load(i))})})}});return t});