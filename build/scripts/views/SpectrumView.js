define([],function(){var e=Backbone.View.extend({initialize:function(){_.bindAll(this),this.component=this.options.component,this.channel=parseInt(this.component.channel,10),this.barPadding=2,this.previousValue=1,this.cleared=!0,this.color="#DBDBDB",this.build()},build:function(e){var t=this,n=this.$el,r=env==="web"?_.template($("#stack-module-spectrum").html()):templates.stack_module_spectrum;n.html(r(this.component)),this.canvas=n.find("canvas")[0],this.module=this.model.get("module"),this.canvas.width=this.module.binCount,this.context=this.canvas.getContext("2d"),this.onFrame()},onFrame:function(){if(_.isUndefined(this.model.collection))return;var e=this.model.collection.chain().filter(function(e){return e.get("category")==="Source"}).any(function(e){return e.get("module").isPlaying}).value();!this.model.get("collapsed")&&e?(this.draw(),this.cleared=!1):!this.cleared&&!e&&(this.clear(),this.cleared=!0),requestAnimFrame(this.onFrame)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},draw:function(){var e=this.context,t=this.canvas,n=this.module.getByteFrequencyData(this.channel),r=this.previousValue,i;this.type=this.module.spectrumType,this.bars=this.module.bars;var s=this.module.binCount/this.bars,o=this.canvas.width/this.bars-2;e.clearRect(0,0,this.canvas.width,300),e.fillStyle=this.color,e.strokeStyle=this.color;if(this.type===0){e.moveTo(0,300),e.beginPath(),e.moveTo(this.canvas.width,300);for(var u=n.length-1;u>=0;u--)e.lineTo(-u+this.canvas.width,-n[u]+300);e.closePath(),e.fill()}else if(this.type===1){e.moveTo(this.canvas.width,300),e.beginPath();for(var u=n.length-1;u>=0;u--)e.lineTo(-u+this.canvas.width,-n[u]+300);e.stroke()}else if(this.type===2)for(var u=n.length-1;u>=0;u-=s){var a=_.max(_.slice(n,u,u-s));e.fillRect(-(u+1)+this.canvas.width,300,o,-a)}}});return e});