define([],function(){var e=Backbone.View.extend({events:{click:"disableDraw"},initialize:function(){_.bindAll(this),this.component=this.options.component,this.type=0,this.previousValue=0,this.cleared=!0,this.disable=!1,this.build()},build:function(e){var t=this,n=this.$el,r=env==="web"?_.template($("#stack-module-reduction-meter").html()):templates.stack_module_reduction_meter;n.html(r(this.component)),this.canvas=n.find("canvas")[0],this.context=this.canvas.getContext("2d"),this.context.fillStyle="#FF0000",this.context.font="16px sans-serif",this.$counter=n.find(".counter"),this.module=this.model.get("module"),this.onFrame()},disableDraw:function(){this.disable=!this.disable,this.disable?this.$el.addClass("disable-meter"):(this.$el.removeClass("disable-meter"),this.onFrame())},onFrame:function(){if(_.isUndefined(this.model.collection))return;if(this.disable)return;var e=this.model.collection.chain().filter(function(e){return e.get("category")==="Source"}).any(function(e){return e.get("module").isPlaying}).value();!this.model.get("collapsed")&&e?(this.draw(),this.cleared=!1):!this.cleared&&!e&&(this.clear(),this.cleared=!0),requestAnimFrame(this.onFrame)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.previousValue=0},draw:function(){var e=this.context,t=this.canvas,n=this.module.getReduction(),r=this.canvas.width,i=this.canvas.height,s=this.type,o=this.previousValue,u;u=n;if(_.isFinite(u)){var a=-(u-o);e.clearRect(0,0,r,i),e.fillRect(r+u,0,-u,i),this.$counter.html(u.toFixed(0)+"db"),this.previousValue=u}}});return e});