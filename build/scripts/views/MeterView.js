define([],function(){return MeterView=Backbone.View.extend({events:{click:"disableDraw"},initialize:function(){_.bindAll(this),this.component=this.options.component,this.channel=parseInt(this.component.channel,10),this.type=0,this.cleared=!0,this.disable=!1,this.previousValue=0,this.build()},build:function(e){var t=this,n=this.$el,r=env==="web"?_.template($("#stack-module-meter").html()):templates.stack_module_meter;n.html(r(this.component)),this.$meter=n.find(".meter"),this.canvas=n.find("canvas")[0],this.context=this.canvas.getContext("2d"),this.context.fillStyle="#FFFF00",this.module=this.model.get("module"),this.onFrame()},disableDraw:function(){this.disable=!this.disable,this.disable?this.$el.addClass("disable-meter"):(this.$el.removeClass("disable-meter"),this.onFrame())},onFrame:function(){if(_.isUndefined(this.model.collection))return;if(this.disable)return;var e=this.model.collection.chain().filter(function(e){return e.get("category")==="Source"}).any(function(e){return e.get("module").isPlaying}).value();!this.model.get("collapsed")&&e?(this.draw(),this.cleared=!1):!this.cleared&&!e&&(this.clear(),this.cleared=!0),requestAnimFrame(this.onFrame)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.previousValue=0},draw:function(){var e=this.context,t=this.canvas,n=this.module.getByteFrequencyData(this.channel),r=this.canvas.width,i=this.canvas.height,s=this.type,o=this.previousValue,u;s===1?u=_.chain(n).map(function(e){return e*e}).reduce(function(e,t){return e+t},0).modify(function(e){return e/n.length}).modify(function(e){return 10*Math.log10(e)}).value():s===0?u=_.chain(n).max().modify(function(e){return(e+o)/2}).value():s===2&&(u=_.chain(n).max().modify(function(e){return 20*Math.log10(e/1024)}).value()),u=~~(.5+u),_.isFinite(u)&&(u>this.previousValue?e.fillRect(this.previousValue,0,u-this.previousValue,i):e.clearRect(u,0,r-u,i),this.previousValue=u)}}),MeterView});