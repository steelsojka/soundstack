define(["views/SelectView","views/SliderView","views/CheckboxView","views/ButtonView","views/FileUploadView","views/MeterView","views/SpectrumView","views/WaveformView","views/WaveformStaticView","views/IndicatorView","views/ReductionMeterView"],function(e,t,n,r,i,s,o,u,a,f,l){var c=Backbone.View.extend({className:"stack-module",rendered:!1,events:{"click .active-toggle":"onToggle","click .arrow-box":"onModuleClick","change .module-menu select":"onMenuChange","change .bypassFx input[type=checkbox]":"onFxBypass"},initialize:function(){var e=this;_.bindAll(this),this.template=env==="web"?_.template($("#templates #stack-module-template").html()):templates.stack_module_template,this.$container=this.options.$container,this.components=new Backbone.Collection;var t=this.$container.children(),n=this.model.get("module");t.length<1?this.$container.append(this.el):this.$container.children().eq(this.options.insertIndex.index).before(this.el),this.model.off("change"),this.model.on("change",this.render),this.model.on("change:settings",this.onSettingsChange),this.model.on("change:collapsed",this._checkCollapsed),this.model.on("reference-select",this.onReference),n.on("stop pause",function(){e.$el.find(".ui-button[data-name=Play]").removeClass("pressed")}),n.on("play",function(){e.$el.find(".ui-button[data-name=Play]").addClass("pressed")}),n.on("start-record",function(){e.$el.find(".ui-button[data-name=Record]").addClass("pressed-red").find("input[type=button]").attr("value","Recording...")}),n.on("pause-record",function(){e.$el.find(".ui-button[data-name=Record]").removeClass("pressed-red").find("input[type=button]").attr("value","Record(paused)")}),n.on("stop-record",function(){e.$el.find(".ui-button[data-name=Record]").removeClass("pressed-red").find("input[type=button]").attr("value","Record")}),this.render()},render:function(){var e=this;this.rendered||(this.$el.html(this.template(this.model.toJSON())),this._checkCollapsed(),parseInt(this.model.get("draggable"))||this.$el.addClass("drag-disable"),this.buildInterface(),this.rendered=!0,this.$el.attr("data-cid",this.model.cid))},buildInterface:function(){var c=this,h=this.model.get("interface").interface,p,d;this.$el.find(".ui-row").each(function(v){p=h[v],$(this).find(".ui-component").each(function(h){var v=$(this),m=v.has(".ui-slider"),g=v.has(".ui-select"),y=v.has(".ui-checkbox"),b=v.has(".ui-button"),w=v.has(".ui-file"),E=v.has(".ui-meter"),S=v.has(".ui-spectrum"),x=v.has(".ui-waveform"),T=v.has(".ui-reduction"),N=v.has(".ui-waveform-static"),C=v.has(".ui-indicator");d=p[h],g.find(".ui-select").each(function(){(function(t){c.components.add(new e({component:t,el:this,model:c.model}))}).call(this,d)}),m.find(".ui-slider").each(function(){(function(e){c.components.add(new t({model:c.model,component:e,el:this}))}).call(this,d)}),y.find(".ui-checkbox").each(function(){(function(e){c.components.add(new n({model:c.model,component:e,el:this}))}).call(this,d)}),b.find(".ui-button").each(function(){(function(e){c.components.add(new r({model:c.model,component:e,el:this}))}).call(this,d)}),E.find(".ui-meter").each(function(){(function(e){c.components.add(new s({model:c.model,component:e,el:this}))}).call(this,d)}),S.find(".ui-spectrum").each(function(){(function(e){c.components.add(new o({model:c.model,component:e,el:this}))}).call(this,d)}),x.find(".ui-waveform").each(function(){(function(e){c.components.add(new u({model:c.model,component:e,el:this}))}).call(this,d)}),N.find(".ui-waveform-static").each(function(){(function(e){c.components.add(new a({model:c.model,component:e,el:this}))}).call(this,d)}),C.find(".ui-indicator").each(function(){(function(e){c.components.add(new f({model:c.model,component:e,el:this}))}).call(this,d)}),T.find(".ui-reduction").each(function(){(function(e){c.components.add(new l({model:c.model,component:e,el:this}))}).call(this,d)}),w.find(".ui-file").each(function(){(function(e){c.components.add(new i({model:c.model,component:e,el:this,collection:c.collection}))}).call(this,d)})})})},onFxBypass:function(e){this.model.set("bypassFx",!e.target.checked),this.collection.trigger("bypass-fx")},onReference:function(e){this.model.set("reference",e),this.collection.trigger("reference-select")},onToggle:function(e){var t=this.$el.find(".active-toggle input")[0];t.checked?(this.model.disable(),t.checked=!1,this.$el.find(".power-switch").addClass("off").removeClass("on")):(this.model.enable(),t.checked=!0,this.$el.find(".power-switch").addClass("on").removeClass("off"))},_checkCollapsed:function(){var e=parseInt(this.model.get("collapsed"),10);e?this.$el.addClass("collapsed").find(".arrow-box").addClass("collapsed").removeClass("uncollapsed").siblings(".rail-screw-bottom-left, .rail-screw-bottom-right").addClass("hide"):this.$el.removeClass("collapsed").find(".arrow-box").removeClass("collapsed").addClass("uncollapsed").siblings(".rail-screw-bottom-left, .rail-screw-bottom-right").removeClass("hide")},onSettingsChange:function(){var e=this.model.get("settings"),t,n;for(var r in e)t=this.components.find(function(e){return e.get("component").name.replace(" ","")===r}),n=t.get("setValue"),_.isUndefined(n)||n(e[r])},onMenuChange:function(e){var t=e.target.selectedOptions[0].value;switch(t){case"remove":this.onModuleRemove();break;case"collapse":this.onModuleClick();break;case"disable":this.onToggle()}e.target.selectedIndex=0},onModuleRemove:function(e){this.collection.remove(this.model)},onModuleClick:function(){var e=parseInt(this.model.get("collapsed"),10);e?this.model.setCollapsed(0):this.model.setCollapsed(1)},destroy:function(){this.remove()}});return c});