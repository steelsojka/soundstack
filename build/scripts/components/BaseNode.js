define(["Emitter","components/Class"],function(e,t){var n=function(e){return e.split(".")},r=function(e){return typeof e!="undefined"},i=t.extend({init:function(e){this.context=r(e)&&e instanceof webkitAudioContext?e:null,this.node=null,this.parameters={},this.inputFrom=[],this.outputTo=[],this.inputNode=null,this.outputNode=null,this._enabled=!0},isEnabled:function(){return this._enabled},setParameters:function(e){return this.parameters=e,this},getContext:function(){return this.node.context},getParameters:function(e){var t=this.parameters;if(e&&e!==""){if(!_.isArray(e))e=n(e);else if(e.length===0)return t;for(var r=0,i=e.length;r<i;r++)e[r]in t?t=t[e[r]]:console.error("Parameter path does not exist")}return t},disconnect:function(e){return typeof e=="undefined"?(this.outputNode.disconnect(),console.log(this.getLabel()+" disconnected all outputs")):(this.outputNode.disconnect(e.getInputNode()),console.log(this.getLabel()+" disconnected from "+e.getLabel())),this},disconnectNode:function(e){return this.outputNode.disconnect(),this.outputTo=_.without(this.outputTo,e),this.reconnect(),this},disconnectAll:function(){return this.disconnect(),this.outputTo=[],this},connectToMaster:function(){return this.getOutputNode().connect(this.getContext().destination),this.setOutput(this.context),console.log(this.getLabel()+" connected to master output"),this},split:function(e){var n=[];for(var r=0,i=arguments.length;r<i;r++){var e=arguments[r];e instanceof t&&(this.connect(e),n.push(e))}return n},connect:function(e,t,n){var r=_.isUndefined(t)?0:t,i=_.isUndefined(n)?0:n,s=this.outputNode.numberOfOutputs,o=e.inputNode.numberOfInputs,u=_.isUndefined(t)||_.isUndefined(n),a;if(s===o&&u)for(a=0;a<o;a++)this.outputNode.connect(e.getInputNode(),a,a);else if(s===1&&o>1&&u)for(a=0;a<o;a++)this.outputNode.connect(e.getInputNode(),0,a);else if(s>1&&o===1&&u)for(a=0;a<s;a++)this.outputNode.connect(e.getInputNode(),a,0);else this.outputNode.connect(e.getInputNode(),r,i);return console.log(this.getLabel()+" => "+e.getLabel()),this.setOutput(e),e.setInput(this),e},reconnect:function(e){var t=e||this.outputTo;if(_.isArray(t))for(var n=0,r=t.length;n<r;n++)this.getOutputNode().connect(t[n].getInputNode());return this},getInputNode:function(){return this.inputNode},getOutputNode:function(){return this.outputNode},setOutput:function(e){return _.contains(this.outputTo,e)||this.outputTo.push(e),this},setInput:function(e){return _.contains(this.inputFrom,e)||this.inputFrom.push(e),this},setInputNode:function(e){return this.inputNode=e,this},setOutputNode:function(e){return this.outputNode=e,this},setLabel:function(e){return this.label=e,this},getLabel:function(){return this.label},getNode:function(){return typeof this.node!="undefined"?this.node:null},modify:function(e,t){var r=n(e),i=this.getParameters(r);return i.value=t,this},automate:function(e){},addParameter:function(e,t){return this.parameters[e]=t,this},listen:function(t,n){var r=this;return e.on(t,function(){n.apply(r,arguments)}),this}});return e.register(i),i});